<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sản phẩm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://kit.fontawesome.com/54f0cb7e4a.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/Trangchu.css">
    <link rel="stylesheet" href="../../css/util.css">
</head>

<body>
    <!--------------------START HEADER -------------------->
    <header>
        <div class="logo">
            <a href="./trangchu.html">JEWELRY</a>
        </div>
        <div class="menu">
            <ul>
                <li><a href="./category.html?cate=Nhẫn">NHẪN</a></li>
                <li><a href="./category.html?cate=Vòng tay">VÒNG TAY</a></li>
                <li><a href="./category.html?cate=Dây chuyền">DÂY CHUYỀN</a></li>
                <li><a href="./category.html?cate=Bông tai">BÔNG TAI</a></li>
                <li><a href="./connect.html">FEEDBACK</a></li>
            </ul>
        </div>
        <div class="others">
            <ul>
                <li><input type="text" placeholder="Search">
                    <i class="fas fa-search"></i>
                </li>
                <li>
                    <a href="cart_detail.html" style="display: flex;">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="badge badge-warning cart num">0</span>
                    </a>
                </li>
            </ul>
        </div>
    </header>
    <!-------------------- END HEADER -------------------->
    <!--------------------START MAIN -------------------->
    <div class="container_product_detail">
        <div class="col">
            <div class="row" style="width:100%;margin-bottom: 60px;">
                <div class=" col col-lg-7 col-md-7 col-sm-12">
                    <div style="width:80%">
                        <img id="product_img" style="width:100%"
                            src="https://static2.yan.vn/YanNews/2167221/202009/ban-tin-60s-thien-thach-gap-doi-dau-truong-la-ma-sap-va-vao-trai-dat-766c683e.jpg"
                            alt="">
                    </div>
                </div>
                <div class="col col-lg-5 col-md-5 col-sm-12">
                    <h2 id="product_name">Bông tai kim cương</h2>
                    <div>
                        <del>
                            <h5 id="product_price"></h5>
                        </del>
                        <h5 id="product_discount_price" style="color: red;"></h5>
                    </div>
                    <div class="row">
                        <div class="wrap-num-product flex-w  ">
                            <div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m ">
                                <i class=" fs-16 fas fa-minus" aria-hidden="true"></i>
                            </div>

                            
                            <input id="quantity" class="mtext-104 cl3 txt-center num-product" type="number" name="num" value="1" disabled>

                            <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m ">
                                <i class="fs-16 fa fa-plus" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 20px;">
                        <button id="add_to_cart_btn" class="btn btn-sm"
                            style="background-color: orangered;color: white;margin-right: 10px;">Thêm vào giỏ
                            hàng</button>
                    </div>
                </div>
            </div>
            <div class="row" style="width:100%">
                <div class="col">
                    <div>
                        <h4 class="description">Mô tả sản phẩm</h4>
                    </div>
                    <div id="product_content" style="padding: 0px 20px;">
                        <!-- Thời gian giao hàng dự kiến cho sản phẩm này là từ 7-9 ngày Thương hiệu: Mala Loại sản phẩm:
                        Vòng tay Dành cho: Nam và nữ Chất liệu: Thép titan Hình dạng: Thánh giá, cây sự sống Phong cách:
                        Phong cách Hàn Quốc Gói hàng bao gồm: 1 x Vòng tay -->
                    </div>

                </div>
            </div>
            <div class="row" style="width:100% ; margin-top: 40px;">
                <div class="col">
                    <div style="margin-bottom:40px;">
                        <h4 class="description">Sản phẩm liên quan</h4>
                    </div>
                    <div class="">
                        <ul id="relatedProduct" class="row">
                            <!-- <li class="item">
                                <a href="">
                                    <h5>bông tai kim cương kim cương</h5>
                                    <div>
                                        <img style="width:100%"
                                            src="../../img/gl0000w000386-lac-tay-vang-trang-y-18k-pnj-01.png" alt="">
                                    </div>
                                    <div>
                                        <del style="color:red">199.000 <u>đ</u></del>
                                        <p>149.000 <u>đ</u></p>
                                    </div>
                                </a>
                            </li> -->
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--------------------END MAIN -------------------->
    <!--------------------START FOOTER -------------------->
    <footer class="hipp">
        <div class="upper-footer">
            <ul>
                <b>Địa chỉ:</b>
                <li> <a
                        href="https://www.google.com/maps/place/TT.+Nghi+Xu%C3%A2n,+Nghi+Xu%C3%A2n,+H%C3%A0+T%C4%A9nh,+Vi%E1%BB%87t+Nam/@18.6646514,105.7543351,16z/data=!3m1!4b1!4m5!3m4!1s0x3139cd2282cf1483:0x4f978238018deadc!8m2!3d18.6642304!4d105.7556564">CS1:
                        Nghi Xuân - Hà Tĩnh</a></li>
                <li><a
                        href="https://www.google.com/maps/place/T%C3%A2y+S%C6%A1n,+B%C3%ACnh+%C4%90%E1%BB%8Bnh,+Vi%E1%BB%87t+Nam/@13.947235,108.7469456,11z/data=!3m1!4b1!4m5!3m4!1s0x316f219e8f9e8b27:0x78abafbfba05394e!8m2!3d13.9479428!4d108.8551484">CS2:
                        Tây Sơn - Bình Định</a></li>
                <li><a
                        href="https://www.google.com/maps/place/G%C3%B2+V%E1%BA%A5p,+Th%C3%A0nh+ph%E1%BB%91+H%E1%BB%93+Ch%C3%AD+Minh,+Vi%E1%BB%87t+Nam/@10.8354056,106.6489834,14z/data=!3m1!4b1!4m5!3m4!1s0x317529078b51e6eb:0x28bd5bd9f01a1edc!8m2!3d10.8386779!4d106.6652904">CS3:
                        Quận Gò Vấp - Thành phố Hồ Chí Minh</a></li>
            </ul>
        </div>
        <div class="upper-footer">
            <a href="tel://65652326565"><b>Hotline</b> : 65652326565</a>
        </div>
        <div class="upper-footer">
            <ul>
                <b>Chủ sở hữu</b> :
                <li><a href="https://www.facebook.com/myy.bling.bling">Nguyễn Thị Trà My</a></li>
                <li><a href="https://www.facebook.com/nguyennhuphuong.242">Nguyễn Thị Như Phượng</a></li>
                <li><a href="https://www.facebook.com/profile.php?id=100034708790293">Nguyễn Anh Tuấn</a></li>
            </ul>
        </div>

    </footer>
    <!--------------------END FOOTER -------------------->

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <script src="../../js/javascript.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script src="../../js/utility.js"></script>

    <script>
        updateCart();
        const id = getUrlParameter('id')
        limitQuantity = 0;

        axios.get('http://localhost:3000/product/' + id)
            .then(function (res) {
                product = res.data.product[0]
                
                
                limitQuantity = product.num

                $('#product_name').text(product.name)

                priceFormat = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price)
                $('#product_price').append(`
                    ${priceFormat} 
                `)

                $('#product_img').attr('src', product.image)

                priceSaleFormat = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price_sale)
                $('#product_discount_price').append(`
                    ${product.price_sale ? priceSaleFormat : ""} 
                `)

                if (!product.price_sale) {
                    child = document.getElementById('product_price');
                    child.parentElement.replaceWith(...child.parentElement.childNodes);
                }

                $('#product_content').append(`
                    ${product.content}
                `)

                category_id = product.category_id



                axios.get('http://localhost:3000/product/search_by_category_id/' + category_id)
                    .then(function (res) {
                        const products = res.data.products;
                        console.log("Diamond", products)
                        n = products.length <= 4 ? products.length : 4


                        for (i = 0; i < n; i++) {
                            product = products[i]
                            if (!product.status || product._id == id  || product.num==0) continue;
                            priceSaleFormat = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price_sale)
                            priceFormat = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price)
                            $('#relatedProduct').append(`
                                <li class="col-md-3 ">
                                    <a href="./product_detail.html?id=${product._id}">
                                        <h5>${product.name}</h5>
                                        <div>
                                            <img style="width:100%"
                                                src="${product.image}" alt="">
                                        </div>
                                        <div>
                                            <del style="color:red">${product.price_sale ? priceFormat : ""}</del>
                                            <p>${product.price_sale ? priceSaleFormat : priceFormat}</p>
                                        </div>
                                    </a>
                                </li>
                            `)
                        }


                    })
                    .catch(function (error) {
                        console.log(error)
                    });
            })
            .catch(function (error) {
                console.log(error)
            })

        $('#add_to_cart_btn').on('click', function (e) {
            storage = localStorage.getItem('cart');
            if (storage) {
                cart = JSON.parse(storage);
            } else {
                cart = [];
            }

            item = cart.find(c => c.id == id);
            if (!item) {
                quantity = $('#quantity').val()
                p = {
                    'id': id,
                    'quantity': quantity
                }
                cart.push(p);
            }
            console.log(cart);
            localStorage.setItem('cart', JSON.stringify(cart));

            alert("Thêm giỏ hàng thành công")
            window.location.href= "./trangchu.html";
        });
    
        $('.btn-num-product-up').on('click', function(e){
            quantity = $('#quantity').val()
            if(quantity > limitQuantity) {
                $('#quantity').val(quantity-1)
            }
        })
    </script>
</body>

</html>